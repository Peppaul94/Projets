import socket
import csv

def scan_port(ip_address, port, open_port, closed_port):
    print ("La cible est: "+ip_address)
    for port_to_scan in port:
            try:
                with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                    print("Checking port: "+str(port_to_scan))
                    s.settimeout(10)  # Set timeout for the connection attempt
                    result = s.connect_ex((ip_address, port_to_scan))
                    if result == 0:
                        print(f"Le port {port_to_scan} de {ip_address} est ouvert")
                        open_port.append(port_to_scan)
                    else:
                        print(f"Le port {port_to_scan} de {ip_address} est fermé ou filtré (Résultat: {result})")
                        closed_port.append(port_to_scan)
            except Exception as e:
                print(f"Erreur: {e}")
    string_openports= str(open_port)
    string_closedports= str(closed_port)
    print("Liste des ports ouverts sur la ou les cible(s): "+string_openports)
    print("Liste des ports fermés sur la ou les cible(s): "+string_closedports)
    file_path = "C:\\Users\\20221292\\Desktop\\Projets\\Python\\listOfOpenPort.csv"
    with open(file_path, "w", newline='', encoding="utf-8") as f:
        writer = csv.writer(f)
        writer.writerow(["Adresse IP de la cible", ip_address])
        writer.writerow(["Liste des ports ouverts", string_openports])
        writer.writerow(["Liste des ports fermés", string_closedports])

ip_address = "10.4.1.113"
port = [22, 80, 135, 139, 445]
open_port=[]
closed_port=[]
scan_port(ip_address, port, open_port, closed_port)
